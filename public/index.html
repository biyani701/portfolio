<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#000000" />
  <meta name="description" content="Web site created using create-react-app" />
  <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
  <!--
      manifest.json provides metadata used when your web app is installed on a
      user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/
    -->
  <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
  <link rel="stylesheet" href="%PUBLIC_URL%/klaro.css" />
  <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
  <title>React App</title>
</head>

<body>
  <noscript>You need to enable JavaScript to run this app.</noscript>
  <div id="root"></div>
  <div id="klaro"></div>
  <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->
  <script>
    window.klaroConfig = {
      version: 2,
      elementID: 'klaro',
      storageMethod: 'cookie',
      cookieName: 'klaro-i18n',
      privacyPolicy: '/privacy-policy.html',
      default: false,
      noNotice: false,
      mustConsent: false,
      acceptAll: true,
      hideDeclineAll: false,
      poweredBy: 'https://github.com/KIProtect/klaro/blob/master/dist/configs/i18n.js',
      services: [
        {
          name: 'tally',
          title: 'Tally Contact Form',
          purposes: ['functional'],
          cookies: [],
          required: false,
          optOut: false,
          onlyOnce: true,
        },
        {
          name: 'norton',
          title: 'Norton Form Protection',
          purposes: ['functional'],
          default: true,
          required: false,
          cookies: [],
        },
      ],
      translations: {
        en: {
          consentModal: {
            title: 'Privacy Preferences',
            description: 'We use a privacy-friendly form service (Tally) to collect contact information. Form submissions are securely processed by Norton. You can manage your preferences below.',
          },
          purposes: {
            functional: 'Essential Services',
          },
          services: {
            tally: {
              description: 'Handles form submissions. No tracking cookies are used.',
            },
            norton: {
              description: 'Processes form data securely for spam protection and integrity.',
            },
          },
        },
        es: {
          consentModal: {
            title: 'Preferencias de privacidad',
            description: 'Usamos Tally para recopilar información de contacto de manera respetuosa con la privacidad. Norton procesa los formularios de forma segura. Puedes gestionar tus preferencias a continuación.',
          },
          purposes: {
            functional: 'Servicios esenciales',
          },
          services: {
            tally: {
              description: 'Gestiona envíos de formularios. No se utilizan cookies de seguimiento.',
            },
            norton: {
              description: 'Procesa datos de formularios de forma segura para proteger contra spam.',
            },
          },
        },
        hi: {
          consentModal: {
            title: 'गोपनीयता प्राथमिकताएं',
            description: 'हम संपर्क जानकारी एकत्र करने के लिए Tally का उपयोग करते हैं। Norton आपके फ़ॉर्म डेटा को सुरक्षित रूप से प्रोसेस करता है। आप नीचे अपनी प्राथमिकताएं प्रबंधित कर सकते हैं।',
          },
          purposes: {
            functional: 'आवश्यक सेवाएं',
          },
          services: {
            tally: {
              description: 'फ़ॉर्म सबमिशन संभालता है। कोई ट्रैकिंग कुकीज़ उपयोग नहीं की जातीं।',
            },
            norton: {
              description: 'स्पैम सुरक्षा के लिए फ़ॉर्म डेटा को सुरक्षित रूप से प्रोसेस करता है।',
            },
          },
        },
      },
    };
  </script>

  
  <script>
    function initializeKlaro() {
      if (window.klaro && typeof window.klaro.run === 'function') {
        try {
          window.klaro.run(window.klaroConfig);
          // Verify that show method is available
          if (typeof window.klaro.show !== 'function') {
            console.error('Klaro initialized but show method is not available');
          }
          console.log('Klaro initialized successfully');
        } catch (error) {
          console.error('Error initializing Klaro:', error);
        }
      } else {
        console.error('Klaro script not loaded properly');
      }
    }
     // Load Klaro script with proper error handling
     document.addEventListener('DOMContentLoaded', function() {
      const klaroScript = document.createElement('script');
      klaroScript.src = "%PUBLIC_URL%/klaro.js";
      klaroScript.onload = initializeKlaro;
      klaroScript.onerror = function() {  
        console.error('Failed to load Klaro script');
      };
      document.body.appendChild(klaroScript);
    });

    // Wait for the script to load
    // if (document.readyState === 'loading') {
    //   document.addEventListener('DOMContentLoaded', initializeKlaro);
    // } else {
    //   initializeKlaro();
    // }
  </script>

<!-- <script 
src="%PUBLIC_URL%/klaro.js"
onload="initializeKlaro()" 
></script> -->

<script>
  // Add multiple event listeners to catch various Klaro events
  function setupKlaroEventListeners() {
    // Main consent updated event
    document.addEventListener('klaro-consent-changed', function(e) {
      console.log('Klaro consent changed, reloading page...');
      setTimeout(() => { location.reload(); }, 200);
    });
    
    // Alternative event name (for different Klaro versions)
    document.addEventListener('klaro-preferences-saved', function(e) {
      console.log('Klaro preferences saved, reloading page...');
      setTimeout(() => { location.reload(); }, 200);
    });
    
    // Your original event
    window.addEventListener('klaro-consents-updated', function(e) {
      console.log('Klaro consents updated, reloading page...');
      setTimeout(() => { location.reload(); }, 200);
    });
    
    // Listen for clicks on the save button directly
    document.addEventListener('click', function(e) {
      if (e.target && (
        e.target.classList.contains('cm-btn-success') || 
        e.target.closest('.cm-btn-success'))
      ) {
        console.log('Consent save button clicked, reloading page shortly...');
        setTimeout(() => { location.reload(); }, 500);
      }
    });
  }
  
  // Set up listeners after a short delay to ensure Klaro is loaded
  document.addEventListener('DOMContentLoaded', function() {
    setTimeout(setupKlaroEventListeners, 1000);
  });
</script>

</body>

</html>